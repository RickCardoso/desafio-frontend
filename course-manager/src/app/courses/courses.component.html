<div class="app-wrapper">
  <header class="courses__header">
    <div class="side-wrapper">
      <img src="../../assets/images/logo_medium.png" alt="CELSO LISBOA">
    </div>
    <h1>Cursos</h1>
    <div class="side-wrapper">
      <button class="btn--pill" (click)="showAddCourse = true; selectedTeachersList = []; selectedRoomsList = [];">Criar</button>
    </div>
  </header>
  
  
  <div class="courses" *ngIf="courses">
    <div class="course" *ngFor="let course of courses" (click)="selectCourse(course)">
      <div class="course__card">
        <span class="course__name" *ngIf="course.nome">{{course.nome}}</span>
    
        <span class="course__teachers" *ngIf="course.professores">
          <span *ngFor="let professor of course.professores; let i = index">
            Prof. {{professor.nome}}{{(i === course.professores.length - 1) ? '' : ' | '}}
          </span>
        </span>
    
        <div class="course__footer">
          <span class="course__rooms" *ngIf="course.salas">
            sala{{(course.salas.length > 1) ? 's ' : ' '}}
            <span *ngFor="let sala of course.salas; let i = index">
              {{sala.sala}}{{(i === course.salas.length - 1) ? '' : ' | '}}
            </span>
          </span>
    
          <span class="course__time" *ngIf="course.inicio && course.fim">{{course.inicio}} às {{course.fim}}</span>
        </div>
    
        <button class="btn--close" (click)="deleteCourse(course.id)">
          <img src="../../assets/images/close_grey.png" alt="">
        </button>
      </div>
    </div>
  </div>
  
  <div class="course--none" *ngIf="!courses || courses.length === 0">
    Não há cursos para exibir.
  </div>
  
  <div class="courses__modal" *ngIf="showAddCourse && teachers && rooms">
    <form class="course__form" (submit)="addCourse(name.value, selectedTeachers.selectedOptions, selectedRooms.selectedOptions, start.value, end.value)">
      <div class="course__form__w100">
        <h1>Criar Curso</h1>
      </div>

      <div class="course__form__w100">
        <input #name placeholder="Nome do Curso">
      </div>
      
      <div class="course__form__w100">
        <div class="custom-multiselect">
          <input #teacherSearch placeholder="Professores" (keyup)="searchTeachers(teacherSearch.value)" (focus)="searchTeachers(teacherSearch.value);">
          
          <div class="custom-multiselect__options" *ngIf="foundTeachers">
            <span class="option" *ngFor="let teacher of foundTeachers" data-id="{{teacher.id}}" (click)="toggleTeacher(teacher.id)" [class.selected]="inArray(teacher, selectedCourse.professores)">
              <span class="icon" *ngIf="inArray(teacher, selectedTeachersList)">
                <svg aria-hidden="true" data-prefix="fal" data-icon="check-circle" class="svg-inline--fa fa-check-circle fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 8C119.033 8 8 119.033 8 256s111.033 248 248 248 248-111.033 248-248S392.967 8 256 8zm0 464c-118.664 0-216-96.055-216-216 0-118.663 96.055-216 216-216 118.664 0 216 96.055 216 216 0 118.663-96.055 216-216 216zm141.63-274.961L217.15 376.071c-4.705 4.667-12.303 4.637-16.97-.068l-85.878-86.572c-4.667-4.705-4.637-12.303.068-16.97l8.52-8.451c4.705-4.667 12.303-4.637 16.97.068l68.976 69.533 163.441-162.13c4.705-4.667 12.303-4.637 16.97.068l8.451 8.52c4.668 4.705 4.637 12.303-.068 16.97z"></path></svg>
              </span>
              {{teacher.nome}}
            </span>
            <span class="option disabled" *ngIf="foundTeachers.length === 0"><em>Professor(a) não encontrado.</em></span>
          </div>

          <select #selectedTeachers multiple>
            <option *ngFor="let teacher of teachers" [value]="teacher.id" [selected]="inArray(teacher, selectedCourse.professores)">{{teacher.nome}}</option>
          </select>
        </div>
        <div class="custom-multiselect__selection" *ngIf="selectedCourse.professores.length > 0">
          <span class="tag" *ngFor="let teacher of selectedCourse.professores">
            {{teacher.nome}}
            <button type="button" class="btn--close" (click)="unselectTeacher(teacher.id)">
              <img src="../../assets/images/close_white.png" alt="x">
            </button>
          </span>
        </div>
      </div>
  
      <div class="course__form__w100">
        <div class="custom-multiselect">
          <input #roomSearch placeholder="Salas" (keyup)="searchRooms(roomSearch.value)" (focus)="searchRooms(roomSearch.value); focusedRoomInput = true">
          
          <div class="custom-multiselect__options" *ngIf="(focusedRoomInput || focusedOption)">
            <span class="option" *ngFor="let room of foundRooms" data-id="{{room.id}}" (click)="toggleRoom(room.id)" [class.selected]="inArray(room, selectedCourse.salas)">
              <span class="icon" *ngIf="inArray(room, selectedRoomsList)">
                <svg aria-hidden="true" data-prefix="fal" data-icon="check-circle" class="svg-inline--fa fa-check-circle fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 8C119.033 8 8 119.033 8 256s111.033 248 248 248 248-111.033 248-248S392.967 8 256 8zm0 464c-118.664 0-216-96.055-216-216 0-118.663 96.055-216 216-216 118.664 0 216 96.055 216 216 0 118.663-96.055 216-216 216zm141.63-274.961L217.15 376.071c-4.705 4.667-12.303 4.637-16.97-.068l-85.878-86.572c-4.667-4.705-4.637-12.303.068-16.97l8.52-8.451c4.705-4.667 12.303-4.637 16.97.068l68.976 69.533 163.441-162.13c4.705-4.667 12.303-4.637 16.97.068l8.451 8.52c4.668 4.705 4.637 12.303-.068 16.97z"></path></svg>
              </span>
              {{room.sala}}
            </span>
            <span class="option disabled" *ngIf="foundRooms.length === 0"><em>Professor(a) não encontrado.</em></span>
          </div>

          <select #selectedRooms multiple>
            <option *ngFor="let room of rooms" [value]="room.id" [selected]="inArray(room, selectedCourse.salas)">{{room.sala}}</option>
          </select>
        </div>
        <div class="custom-multiselect__selection" *ngIf="selectedCourse.salas.length > 0">
          <span class="tag" *ngFor="let room of selectedCourse.salas">
            {{room.sala}}
            <button type="button" class="btn--close" (click)="unselectRoom(room.id)">
              <img src="../../assets/images/close_white.png" alt="x">
            </button>
          </span>
        </div>
      </div>
        
      <div class="course__form__w50">
        <input #start placeholder="Início">
      </div>
      <div class="course__form__w50">
        <input #end placeholder="Fim">
      </div>
  
      <div class="course__form__w100">
        <button class="btn">Salvar</button>
      </div>  

      <button type="button" class="btn--close" (click)="showAddCourse = false">
        <img src="../../assets/images/close_white.png" alt="">
      </button>
    </form>
  </div>
  
  <div class="courses__modal" *ngIf="selectedCourse && teachers && rooms">
    <div class="course__form">
      <input #id [value]="selectedCourse.id" type="hidden">

      <div class="course__form__w100">
        <h1>Editar Curso</h1>
      </div>

      <div class="course__form__w100">
        <input #name [value]="selectedCourse.nome">
      </div>
      
      <div class="course__form__w100">
        <div class="custom-multiselect">
          <input #teacherSearch placeholder="Professores" (keyup)="searchTeachers(teacherSearch.value)" (focus)="searchTeachers(teacherSearch.value);">
          
          <div class="custom-multiselect__options" *ngIf="foundTeachers">
            <span class="option" *ngFor="let teacher of foundTeachers" data-id="{{teacher.id}}" (click)="toggleTeacher(teacher.id)" [class.selected]="inArray(teacher, selectedTeachersList)">
              <span class="icon" *ngIf="inArray(teacher, selectedTeachersList)">
                <svg aria-hidden="true" data-prefix="fal" data-icon="check-circle" class="svg-inline--fa fa-check-circle fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 8C119.033 8 8 119.033 8 256s111.033 248 248 248 248-111.033 248-248S392.967 8 256 8zm0 464c-118.664 0-216-96.055-216-216 0-118.663 96.055-216 216-216 118.664 0 216 96.055 216 216 0 118.663-96.055 216-216 216zm141.63-274.961L217.15 376.071c-4.705 4.667-12.303 4.637-16.97-.068l-85.878-86.572c-4.667-4.705-4.637-12.303.068-16.97l8.52-8.451c4.705-4.667 12.303-4.637 16.97.068l68.976 69.533 163.441-162.13c4.705-4.667 12.303-4.637 16.97.068l8.451 8.52c4.668 4.705 4.637 12.303-.068 16.97z"></path></svg>
              </span>
              {{teacher.nome}}
            </span>
            <span class="option disabled" *ngIf="foundTeachers.length === 0"><em>Professor(a) não encontrado.</em></span>
          </div>

          <select #selectedTeachers multiple>
            <option *ngFor="let teacher of teachers" [value]="teacher.id" selected="{{inArray(teacher, selectedTeachersList)}}">{{teacher.nome}}</option>
          </select>
        </div>
        <div class="custom-multiselect__selection" *ngIf="selectedTeachersList.length > 0">
          <span class="tag" *ngFor="let teacher of selectedTeachersList">
            {{teacher.nome}}
            <button type="button" class="btn--close" (click)="unselectTeacher(teacher.id)">
              <img src="../../assets/images/close_white.png" alt="x">
            </button>
          </span>
        </div>
      </div>
  
      <div class="course__form__w100">
        <div class="custom-multiselect">
          <input #roomSearch placeholder="Salas" (keyup)="searchRooms(roomSearch.value)" (focus)="searchRooms(roomSearch.value); focusedRoomInput = true">
          
          <div class="custom-multiselect__options" *ngIf="(focusedRoomInput || focusedOption)">
            <span class="option" *ngFor="let room of foundRooms" data-id="{{room.id}}" (click)="toggleRoom(room.id)" [class.selected]="inArray(room, selectedRoomsList)">
              <span class="icon" *ngIf="inArray(room, selectedRoomsList)">
                <svg aria-hidden="true" data-prefix="fal" data-icon="check-circle" class="svg-inline--fa fa-check-circle fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 8C119.033 8 8 119.033 8 256s111.033 248 248 248 248-111.033 248-248S392.967 8 256 8zm0 464c-118.664 0-216-96.055-216-216 0-118.663 96.055-216 216-216 118.664 0 216 96.055 216 216 0 118.663-96.055 216-216 216zm141.63-274.961L217.15 376.071c-4.705 4.667-12.303 4.637-16.97-.068l-85.878-86.572c-4.667-4.705-4.637-12.303.068-16.97l8.52-8.451c4.705-4.667 12.303-4.637 16.97.068l68.976 69.533 163.441-162.13c4.705-4.667 12.303-4.637 16.97.068l8.451 8.52c4.668 4.705 4.637 12.303-.068 16.97z"></path></svg>
              </span>
              {{room.sala}}
            </span>
            <span class="option disabled" *ngIf="foundRooms.length === 0"><em>Professor(a) não encontrado.</em></span>
          </div>

          <select #selectedRooms multiple>
            <option *ngFor="let room of rooms" [value]="room.id" selected="{{inArray(room, selectedRoomsList)}}">{{room.sala}}</option>
          </select>
        </div>
        <div class="custom-multiselect__selection" *ngIf="selectedRoomsList.length > 0">
          <span class="tag" *ngFor="let room of selectedRoomsList">
            {{room.sala}}
            <button type="button" class="btn--close" (click)="unselectRoom(room.id)">
              <img src="../../assets/images/close_white.png" alt="x">
            </button>
          </span>
        </div>
      </div>
      
      <div class="course__form__w50">
        <input #start [value]="selectedCourse.inicio">      
      </div>
      <div class="course__form__w50">
        <input #end [value]="selectedCourse.fim">
      </div>
  
      <div class="course__form__w100">
        <button class="btn" (click)="editCourse(id.value, name.value, selectedTeachers.selectedOptions, selectedRooms.selectedOptions, start.value, end.value)">Salvar</button>
      </div>
  
      <button class="btn--close" (click)="selectedCourse = null">
        <img src="../../assets/images/close_white.png" alt="">
      </button>
    </div>
  </div>
</div>